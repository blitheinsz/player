(function(h,f){h=h.SewisePDF.QuestionsPlay=function(a){this.pdfPlugin=a;this.questionIndex=0;this.questionObj=null;this.isAnswering=!1;this.currentTopicShowTime=0;this.delayTime=1500;this.redLineDic={};this.haveDrawTopicLine=!1;this.allQuestionArr=this.topicDetailEle=null;this.isSeek=!1};h.prototype.init=function(){var a=this.pdfPlugin.player.getPlayerContainer();f(a).append('<div class="topicDetail"><div class="topicDetail-header"><span style="font-size: 20px;color:#333;padding-left: 25px;" class="topicDetail-title">\u95ee\u7b54\u9898</span></div><div class="topicDetail-tDetail"></div><div class="topicDetail-btnDiv"><button type="button" class="btn btn-primary btnSubmit">\u63d0\u4ea4</button></div></div>');
this.topicDetailEle=f(a).find(".topicDetail");f(document.body).append('<div class="modal" id="sewiseModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog modal-sewise-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title" id="sewise-ModalLabel">Modal title</h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button><button type="button" class="btn btn-primary btn-sewise-sure">\u786e\u5b9a</button></div></div></div></div>')};
h.prototype.initTopicLines=function(a){};h.prototype.seekClickHandle=function(a){return 0<this.allQuestionArr.length&&this.pdfPlugin.openQuestion&&this.pdfPlugin.showQuestion&&a>this.currentTopicShowTime?(this.pdfPlugin.isFullScreen?alert("\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01"):this.alertMessage("<p>\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01</p>","\u63d0\u793a",400,310),!1):
!0};h.prototype.checkShowQuestionBox=function(a){if(!this.isAnswering&&this.pdfPlugin.showQuestion&&!(this.pdfPlugin.param.studyProgress&&100==this.pdfPlugin.param.studyProgress||this.isSeek)){a*=1E3;var c=this.pdfPlugin.kyuanObj.topic_json,d,b,e,g;b=c.length;for(var f=0;f<b;f++)e=c[f],d=this.pdfPlugin.calcalateKyuanTime(this.pdfPlugin.kyuanObj)+this.pdfPlugin.kyuanObj.duration,d=Math.abs(a-1E3*d),0<d&&700>d&&!e.isShow&&!e.answerRight?(e.isLast&&(g=!0),this.questionIndex=f,this.setShowQuestion(e,
g)):0<d&&700>d&&e.isShow&&!e.answerRight&&this.questionObj&&e.uuid===this.questionObj.uuid&&(e.isLast&&(g=!0),this.questionIndex=f,this.setShowQuestion(e,g))}};h.prototype.setShowQuestion=function(a,c){var d=this;this.pdfPlugin.currentShowVideo.pause();this.pdfPlugin.player.lockScreen(!0);this.isAnswering=!0;a.isAnswer||(this.currentTopicShowTime=this.pdfPlugin.virtualPlayTime);var b=this.pdfPlugin.kyuanObj.topic_json,e=b.length;if(this.questionObj)for(c=0;c<e;c++){var g=b[c];g.uuid===this.questionObj.uuid&&
(g.isShow=!1)}a.isShow=!0;a.isAnswer=!0;this.questionObj=a;this.topicDetailEle.show();this.topicDetailEle.find(".topicDetail-tDetail").empty();a.type&&"multiple"===a.type?this.topicDetailEle.find(".topicDetail-header span").text("\u95ee\u7b54\u9898[\u591a\u9009]"):this.topicDetailEle.find(".topicDetail-header span").text("\u95ee\u7b54\u9898[\u5355\u9009]");b='<div class="tDetail-q">'+a.question+"</div>";e=["A","B","C","D"];for(c=0;c<a.answer.length;c++)b=a.type&&"multiple"===a.type?b+('<div class="tDetail-a" name="'+
c+'"><input type="checkbox" value="'+a.answer[c].rightAnswer+'"  name="'+a.uuid+'"></input><span>&nbsp&nbsp'+e[c]+".&nbsp&nbsp"+a.answer[c].content+"</span></div>"):b+('<div class="tDetail-a" name="'+c+'"><input type="radio" value="'+a.answer[c].rightAnswer+'"  name="'+a.uuid+'"></input><span>&nbsp&nbsp'+e[c]+".&nbsp&nbsp"+a.answer[c].content+"</span></div>");this.topicDetailEle.find(".topicDetail-tDetail").append(b);this.topicDetailEle.find(".btnSubmit").unbind("click");this.topicDetailEle.find(".btnSubmit").bind("click",
function(a){0===d.topicDetailEle.find(".tDetail-a").find("input:checked").length?d.pdfPlugin.isFullScreen?alert("\u8bf7\u9009\u62e9\u7b54\u6848\u518d\u63d0\u4ea4!"):d.alertMessage("<p>\u8bf7\u9009\u62e9\u7b54\u6848\u518d\u63d0\u4ea4\uff01</p>","\u63d0\u793a",400,310):(a=d.topicDetailEle.find(".tDetail-a").find("input"),d.delayTime=1500,d.doSubmitLogic(a),d.clear())});this.pdfPlugin.player.fireEvent("sewise-pause-send")};h.prototype.doSubmitLogic=function(a){var c=a.length,d=!1,b=[];this.questionObj.type&&
"multiple"===this.questionObj.type&&(d=!0);for(var e=0;e<c;e++){var g=a[e];if(g.checked)if(d)g=f(g).parent().attr("name"),b.push(parseInt(g));else{g=f(g).parent().attr("name");b.push(parseInt(g));break}}this.pdfPlugin.player.fireEvent("sewise-topic-answer",{questionid:this.questionObj.id,answerIDArr:b,kyuan:this.pdfPlugin.kyuanObj})};h.prototype.answerRespose=function(a){function c(){f(b.pdfPlugin.currentShowVideo).unbind("seeked",c);b.pdfPlugin.updateTimeText(b.pdfPlugin.currentShowVideo.currentTime);
b.isSeek=!1;b.isAnswering=!1;b.pdfPlugin.currentShowVideo.play()}function d(){b.pdfPlugin.canQuestionJump?(f(b.pdfPlugin.currentShowVideo).bind("seeked",c),b.isSeek=!0,b.pdfPlugin.currentShowVideo.currentTime=b.pdfPlugin.kyuanObj.pdf_json.sTime):(b.pdfPlugin.player.fireEvent("sewise-topic-answer-end"),b.isAnswering=!1)}var b=this,e=this.questionObj;e.answerRight=a;e.isDoAnswer=!0;a?(this.questionObj.isLast&&this.pdfPlugin.player&&(this.currentTopicShowTime=this.pdfPlugin.totalDuration),this.pdfPlugin.canQuestionJump?
(this.questionObj.isLast&&this.pdfPlugin.kyuanIndex==this.pdfPlugin.kyuanArr.length-1?this.pdfPlugin.playEndContro():this.pdfPlugin.currentShowVideo.play(),setTimeout(function(){b.isAnswering=!1},500)):this.pdfPlugin.player.fireEvent("sewise-topic-answer-end")):this.pdfPlugin.isFullScreen?(alert("\u5f88\u9057\u61be,\u56de\u7b54\u9519\u8bef!"),d()):this.alertMessage("<p>\u5f88\u9057\u61be,\u56de\u7b54\u9519\u8bef\uff01</p>","\u63d0\u793a",400,310,function(){d()})};h.prototype.delayShowQuestion=function(){var a=
this;0==a.questionObj.showTime&&-1==a.questionObj.errorJumpTime&&(a.delayTime=100);setTimeout(function(){a.isAnswering=!1},a.delayTime)};h.prototype.alertMessage=function(a,c,d,b,e){f("#sewiseModal .modal-sewise-dialog").css("width",d+"px");f("#sewiseModal .modal-sewise-dialog").css("height",b+"px");f("#sewise-ModalLabel").text(c);f("#sewiseModal .modal-body").empty();f(a).appendTo("#sewiseModal .modal-body");f("#sewiseModal").find(".modal-footer .btn-default").hide();var g=f("#sewiseModal").find(".btn-sewise-sure");
g.bind("click",function(a){f("#sewiseModal").modal("hide")});f("#sewiseModal").modal("show");f("#sewiseModal").on("hide.bs.modal",function(a){f("#sewiseModal .modal-body").empty();g.unbind("click");e&&(e(),e=null)})};h.prototype.clear=function(){this.topicDetailEle.find(".btnSubmit").unbind("click");this.topicDetailEle.hide();this.topicDetailEle.find(".topicDetail-tDetail").empty();this.pdfPlugin.player.lockScreen(!1)};h.prototype.reset=function(){this.isSeek=this.isAnswering=!1;this.pdfPlugin.progressBox.find(".topicRedTimeLine").remove();
this.haveDrawTopicLine=!1;this.redLineDic={};this.lookAllQuestion();0<this.allQuestionArr.length&&(this.currentTopicShowTime=this.allQuestionArr[0].showTime)};h.prototype.drawRedTimeLine=function(a){var c=this.pdfPlugin.progressBox.width(),d=1E3*this.pdfPlugin.player.duration(),c=c/d*a.showTime*1E3,d=document.createElement("div");d.className="topicRedTimeLine";d.style.left=c+"px";this.redLineDic[a.id]=d;this.pdfPlugin.progressBox.append(d)};h.prototype.getTopicObjByID=function(a){for(var c=this.pdfPlugin.questionJsonData.data,
d=c.length,b=0;b<d;b++)if(c[b].id===a)return c[b];return null};h.prototype.getTopicObjByTime=function(a){for(var c=this.pdfPlugin.getkyuanArrByVideoUrl(this.pdfPlugin.kyuanObj.fullname),d=c.length,b=0;b<d;b++)for(var e=c[b].topic_json,g=0;g<e.length;g++)if(e[g].showTime===a)return e[g];return null};h.prototype.lookAllQuestion=function(){this.allQuestionArr=[];for(var a=this.pdfPlugin.swlJsonData.Knowledge_point.length,c=0;c<a;c++)for(var d=this.pdfPlugin.swlJsonData.Knowledge_point[c],b=0;b<d.knowledge_element.length;b++){var e=
d.knowledge_element[b];if(e.topic_json)for(var g=0;g<e.topic_json.length;g++){var f=e.topic_json[g];f.kyuan_uuid=e.elgid2;f.kpoint_uuid=d.klgid;f.uuid||(f.uuid=f.id);this.allQuestionArr.push(f)}}0<this.allQuestionArr.length&&(this.allQuestionArr[this.allQuestionArr.length-1].isLast=!0)}})(window,window.jQuery);