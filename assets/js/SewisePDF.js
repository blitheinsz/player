(function(l,b){function m(a){a.originalEvent.stopPropagation?a.originalEvent.stopPropagation():a.originalEvent.cancelBubble=!0}var d=l.SewisePDF=function(a){this.videourl=this.video=this.player=null;this.param=a;this.pdfJsonData=a.pdfJsonData;this.pdfPageObj=null;this.pdfPageIndex=0;this.scaleImgItemList=[];this.progressBox=this.videoContainer=this.playerContainer=null;this.pdfLoad=this.haveThumb=!1;this.totalPage=1;this.effectDuration=220;this.rightCornerImg=this.playerHeight=this.playerWidth=null;
this.videoOnRT=this.pdfOnRT=!1;this.arrow=this.bigPlayBtn=null;this.initBtn=this.haveInit=!1;this.elementObj=null;this.mainContainerH=this.mainContainerW=this.oldContainerParentH=this.oldControlbarBottom=this.oldVideoH=0;this.nettip=this.pdfViewerChildBox=this.pdfPage=this.pdfTextBox=this.loadingIcon=this.pdfCanvas=this.pdfCanvasWrapper=this.pdfMainBox=null;this.scaleBoxHide=this.isFullScreen=!1;this.greyRectDic={};this.maxPlayTime=0;this.hideZXueBtnState=this.openZhiXue=this.defaultOpenZXue=!1;this.pdfZXuePageIndex=
this.hidePageNum=0;this.canQuestionJump=!0;this.questionObj=new l.SewisePDF.QuestionsPlay(this);this.questionJsonData=a.questionJsonData;this.knowledgeTitleEle=null;this.showQuestion=!0;this.preLoadVideoTool=new l.SewisePDF.PreLoadVideoTool(this);this.doInit()};d.fn=d.prototype;d.fn.doInit=function(){this.swlJsonData=null;this.kpointArr=[];this.kpointIndex=0;this.kyuanArr=[];this.kyuanObj=null;this.kyuanIndex=0;this.playMode="single";this.pdfToolDic={};this.loadProgressDic={};this.pdfTool=null;this.loadPdfNum=
0;this.pdfUrlArr=[];this.videoUrlArr=[];this.playEnd=!1;this.playState="";this.totalDuration=0;this.videoOnRT=this.pdfOnRT=!1;this.virtualPlayTime=0;this.openQuestion=!0;this.currentShowVideo=null;this.isRenderPage=this.isChangeVideo=!1;this.waitTimeOutID=-1;this.hasCanPlay=this.isWaiting=this.isSeeking=!1};d.fn.init=function(a){this.player=a;this.video=a.getVideo();this.playerContainer=a.getPlayerContainer();this.videoContainer=a.getVideoContainer();this.progressBox=b(this.playerContainer).find(".controlbar-progress");
this.knowledgeTitleEle=b(this.playerContainer).find(".scaleIcon-knowledge-title");this.nettip=b(this.playerContainer).find(".controlbar-nettip");this.player.playController.canHideSkin=!1;this.player.timeupdateOpen=!1;this.player.closeBtnEvent=!0;this.playerWidth=b(this.playerContainer).width();this.playerHeight=b(this.playerContainer).height();this.videourl=this.player.playController.playVars.videoUrl?this.player.playController.playVars.videoUrl:this.player.playController.playVars.streamUrl;this.player.on("updateVideoUrl",
b.proxy(this.updatePlayer,this));this.player.on("fullScreen",b.proxy(this.fullSceenHandle,this));this.player.on("controlbarShowState",b.proxy(this.controlbarStateHandle,this));this.player.on("cancelFullScreen",b.proxy(this.cancelFullScreenHandle,this));this.player.on("seekLinePercentage",b.proxy(this.seekedProHandle,this));this.player.on("durationChange",b.proxy(this.durationHandle,this));this.elementObj=this.player.playController.skinController.getElementObject();this.bigPlayBtn=this.elementObj.$bigPlayBtn;
this.elementObj.$pauseBtn.bind("click",b.proxy(this.pauseBtnClickHandle,this));this.elementObj.$playBtn.bind("click",b.proxy(this.playBtnClickHandle,this));this.bigPlayBtn.bind("click",b.proxy(this.playBtnClickHandle,this));this.questionObj.init()};d.fn.filterPdfData=function(){for(var a=this.pdfJsonData.data.length,b,c=[],e=0;e<a;e++)b=this.pdfJsonData.data[e],b.hasOwnProperty("show")&&!1===b.show||c.push(b);this.pdfJsonData.data=c};d.fn.reset=function(a){if(this.pdfToolDic)for(var f in this.pdfToolDic)this.pdfToolDic[f].clear();
b(this.playerContainer).find(".controlbar-scaleIcon img").remove();this.haveThumb=this.pdfLoad=!1;this.scaleImgItemList=[];this.greyRectDic={};this.progressBox.find(".greyTimeRect").remove();this.defaultOpenZXue=a.defaultOpenZXue;this.pdfPageIndex=this.maxPlayTime=this.pdfZXuePageIndex=this.hidePageNum=0;this.pdfPageObj=null;this.doInit();this.param=a;this.openQuestion=a.openQuestion;this.swlJsonData=a.swlJsonData;this.questionObj.clear();this.questionObj.reset();this.preLoadVideoTool.clear();b(l).unbind("sewiseAllPdfRenderEnd");
b(l).unbind("sewisePdfLoadProgress");l.SewisePDF.activePdfPlugin=this;this.rightCornerImg&&b(this.rightCornerImg).remove();this.param.subtitlePlugin&&b(this.param.subtitlePlugin.subContainer).show();"play"!=this.player.playController.state&&this.bigPlayBtn.show();b(this.videoContainer).css("margin-left","0px").css("margin-top","0px");this.player.playController.skinController.volume(.8);this.playMode="complex";this.currentShowVideo=this.player.getVideo();b(this.currentShowVideo).show();this.registerVideoEvent(this.currentShowVideo);
this.playState="pause";"complex"===this.playMode?(this.player.lockScreen(!0),this.loadingIcon&&this.loadingIcon.show(),this.calcalatePdfUrlArr(),this.changeControlbarPos(!1),this.adjustVideoPositon(parseInt(this.kyuanArr[0].pdf_json.vpercent)),this.totalPage=this.kyuanArr.length,b(this.playerContainer).find(".controlbar-other-pageTool").show(),b(this.playerContainer).find(".controlbar-other-page").text(this.kyuanIndex+1+"/"+this.totalPage),this.param.seekTime?(this.kyuanObj=this.getKYuanObjByVirtualTime(this.param.seekTime),
this.kyuanIndex=this.getPdfObjInArrIndex(this.kyuanObj.elgid2),this.calculateZXueIndex(this.kyuanIndex),a=this.getSeekTime(this.param.seekTime),0==this.kyuanIndex?(this.player.toPlay(this.kyuanObj.fullname,"\u6b63\u5728\u64ad\u653e:"+this.kyuanObj.kpointTitle,a,!1),this.preLoadVideoTool.loadVideo(this.videoUrlArr)):(f=this.kyuanArr[0],f.fullname!=this.kyuanObj.fullname?(this.player.toPlay(f.fullname,"\u6b63\u5728\u64ad\u653e:"+f.kpointTitle,f.pdf_json.sTime,!1),this.preLoadVideoTool.loadVideo(this.videoUrlArr),
this.goPlay(!0,this.kyuanObj,!1,a)):(this.player.toPlay(this.kyuanObj.fullname,"\u6b63\u5728\u64ad\u653e:"+this.kyuanObj.kpointTitle,a,!1),this.preLoadVideoTool.loadVideo(this.videoUrlArr)))):(this.kyuanObj=this.kyuanArr[this.kyuanIndex],this.player.toPlay(this.kyuanObj.fullname,"\u6b63\u5728\u64ad\u653e:"+this.kyuanObj.kpointTitle,this.kyuanObj.pdf_json.sTime,!1),this.preLoadVideoTool.loadVideo(this.videoUrlArr)),this.initPdf(),this.adjustVideoPositon(parseInt(this.kyuanObj.pdf_json.vpercent))):
(this.videoContainer.style.width="100%",this.videoContainer.style.height="100%",this.changeControlbarPos(!0),this.bigPlayBtn.css("left","50%"),b(this.playerContainer).find(".controlbar-other-pageTool").hide(),this.arrow&&this.arrow.hide());this.caluateVttBoxPos()};d.fn.adjustVideoPositon=function(a){a||(a=60);this.videoContainer.style.width=a+"%";this.videoContainer.style.height="100%";this.videoContainer.style.marginLeft="0px";this.videoContainer.style.marginTop="0px";this.pdfMainBox&&(this.pdfMainBox.show(),
this.pdfMainBox.css("width",100-a+"%"),this.pdfMainBox.css("height","100%"),this.pdfMainBox.css("margin-left",a+"%"));this.videoOnRT=this.pdfOnRT=!1;this.rightCornerImg&&b(this.rightCornerImg).remove();this.pdfCanvasWrapper&&this.pdfCanvasWrapper.css("display","block");this.changeElementPos()};d.fn.clearPlayData=function(){if(this.pdfToolDic){for(var a in this.pdfToolDic)this.pdfToolDic[a].clear();this.pdfToolDic=null}b(this.playerContainer).find(".controlbar-scaleIcon img").remove();this.videoContainer.style.width=
"100%";this.videoContainer.style.height="100%";this.changeControlbarPos(!0);this.arrow&&this.arrow.hide();this.pdfMainBox&&this.pdfMainBox.hide();this.questionObj.clear();this.questionObj.isAnswering=!1;this.param.subtitlePlugin.clear();b(this.param.subtitlePlugin.subContainer).empty();b(this.playerContainer).find(".controlbar-other-page").text("0/0");this.player.lockScreen(!0)};d.fn.calcalatePdfUrlArr=function(){for(var a=0;a<this.swlJsonData.Knowledge_point.length;a++){var b=this.swlJsonData.Knowledge_point[a],
c=b.assist_url;-1==this.pdfUrlArr.indexOf(c)&&this.pdfUrlArr.push(c);for(c=0;c<b.knowledge_element.length;c++){var e=b.knowledge_element[c];e.kpoint_uuid=b.klgid;e.kpointTitle=b.title;e.kpointImage=b.image;e.clear=b.clear;this.kyuanArr.push(e);this.haveVideoUrl(b.video_url)||this.videoUrlArr.push({url:b.video_url,seekTime:e.pdf_json.sTime})}}};d.fn.haveVideoUrl=function(a){for(var b=0;b<this.videoUrlArr.length;b++)if(this.videoUrlArr[b].url==a)return!0;return!1};d.fn.getAllKyuanArrByKpointID=function(a){for(var b=
[],c=0;c<this.kyuanArr.length;c++)this.kyuanArr[c].kpoint_uuid==a&&b.push(this.kyuanArr[c]);return b};d.fn.checkAllYuanClear=function(){for(var a=0;a<this.kyuanArr.length;a++)if(!this.kyuanArr[a].clear)return!1;return!0};d.fn.getkyuanArrByVideoUrl=function(a){for(var b=[],c=0;c<this.swlJsonData.Knowledge_point.length;c++)for(var e=this.swlJsonData.Knowledge_point[c],d=0;d<e.knowledge_element.length;d++){var k=e.knowledge_element[d];k.fullname===a&&b.push(k)}return b};d.fn.calcalateVideoDuration=function(){for(var a=
this.kyuanArr.length,b=0,c=0;c<a;c++)b+=this.kyuanArr[c].duration;return b};d.fn.calcalateKyuanTime=function(a){for(var b=this.kyuanArr.length,c=0,e=0;e<b;e++){var d=this.kyuanArr[e];if(a.elgid==d.elgid&&a.start_time==d.start_time)break;else c+=d.duration}return c};d.fn.changeControlbarPos=function(a){(this.scaleBoxHide=a)?(b(this.playerContainer).find(".controlbar-scaleIcon").hide(),b(this.playerContainer).find(".controlbar-scaleIcon-bg").hide(),this.elementObj.$controlbar.css("height","77px"),this.isFullScreen?
this.elementObj.$controlbar.css("bottom","0px"):this.elementObj.$controlbar.css("bottom","-77px")):(b(this.playerContainer).find(".controlbar-scaleIcon").show(),b(this.playerContainer).find(".controlbar-scaleIcon-bg").show(),this.elementObj.$controlbar.css("height","106px"),this.isFullScreen?this.elementObj.$controlbar.css("bottom","0px"):this.elementObj.$controlbar.css("bottom","-106px"))};d.fn.doVideoDrag=function(){function a(a){document.selection&&document.selection.empty();window.getSelection&&
window.getSelection().removeAllRanges();d=a.pageX-e;if(!(0===d||0<d&&c.pdfOnRT||0>d&&c.videoOnRT||c.isRenderPage)){e=a.pageX;a=b(c.videoContainer).width()+d;var h=c.playerWidth-a;b(c.videoContainer).css("width",a+"px");c.pdfMainBox.css("width",h+"px");c.pdfMainBox.css("margin-left",a+"px");c.arrow.css("left",b(c.videoContainer).outerWidth(!0)-c.arrow.width()/2+"px");c.caluateVttBoxPos();c.pdfOnRT||c.pdfToolDic[c.kyuanObj.pdfurl].refreshPageView();h<a/8&&!c.pdfOnRT?(f(),c.pdfOnRT=!0,b(c.videoContainer).css("width",
c.playerWidth+"px"),c.caluateVttBoxPos(),b(c.videoContainer).css("z-index","0"),c.pdfMainBox.append(c.rightCornerImg),b(c.rightCornerImg).width(Math.floor(a/8)),h=parseInt(a/8*c.mainContainerH/c.mainContainerW),b(c.rightCornerImg).height(h),c.pdfCanvasWrapper.css("display","none"),c.arrow.removeClass("sewise-dragMarkArrow").addClass("sewise-dragMarkArrow-left"),c.arrow.css("left",c.playerWidth-a/8-30-c.arrow.width()/2+"px")):h>a/8&&c.pdfOnRT?(b(c.rightCornerImg).remove(),c.pdfCanvasWrapper.css("display",
"block"),b(".vodSimpleVPass .sewise-dragMarkArrow").show(),c.arrow.removeClass("sewise-dragMarkArrow-left").addClass("sewise-dragMarkArrow"),c.pdfOnRT=!1):a<h/8&&!c.videoOnRT?(f(),c.videoOnRT=!0,c.pdfMainBox.css("width",c.playerWidth+"px"),c.pdfMainBox.css("margin-left","0px"),b(c.videoContainer).css("width","125px"),b(c.videoContainer).css("height","125px"),b(c.videoContainer).css("margin-left","30px").css("margin-top","30px"),b(c.videoContainer).css("z-index","6"),"play"===c.playState&&c.bigPlayBtn.hide(),
c.arrow.removeClass("sewise-dragMarkArrow").addClass("sewise-dragMarkArrow-right"),c.arrow.css("left",155-c.arrow.width()/2+"px"),a=c.pdfToolDic[c.kyuanObj.pdfurl],a.draw(),a.calculatePos()):a>h/8&&c.videoOnRT&&(c.videoOnRT=!1,c.param.subtitlePlugin&&b(c.param.subtitlePlugin.subContainer).show(),"play"!=c.playState&&c.bigPlayBtn.show(),b(c.videoContainer).css("margin-left","0px").css("margin-top","0px"),b(c.videoContainer).css("height",c.playerHeight+"px"),c.arrow.removeClass("sewise-dragMarkArrow-right").addClass("sewise-dragMarkArrow"))}}
function f(e){b(c.playerContainer).unbind("mousemove",a);b(document).unbind("mouseup",f);e&&"big-play-icon"!=e.target.className&&c.pdfToolDic[c.kyuanObj.pdfurl].draw()}var c=this,e,d;b(this.playerContainer).height();b(this.playerContainer).mousedown(function(d){m(d);"#"==c.player.playController.playVars.url||!c.haveThumb||c.openZhiXue&&"controlbar-scaleIcon"===d.target.className||(e=d.pageX,b(c.playerContainer).bind("mousemove",a),b(document).bind("mouseup",f))});this.elementObj.$controlbar.mousedown(function(a){"controlbar-scaleIcon"!=
a.target.className&&m(a)})};d.fn.caluateVttBoxPos=function(){var a=b(this.playerContainer).width();this.param.subtitlePlugin&&(b(this.param.subtitlePlugin.subContainer).css("width",a+"px"),a=b(this.param.subtitlePlugin.subContainer).children().first().width(),b(this.param.subtitlePlugin.subContainer).children().first().children().width(a))};d.fn.changeElementPos=function(){b(this.videoContainer).width();this.arrow&&this.arrow.css("left",b(this.videoContainer).outerWidth(!0)-this.arrow.width()/2+"px")};
d.fn.initPdf=function(){var a=this.kyuanArr[0];l.SewisePDF.pdfUrl=a.pdfurl;l.SewisePDF.pdfWorkerUrl="../assets/js/pdf.worker.js";l.SewisePDF.useThumbview=!0;b(l).bind("sewisePdfLoadProgress",b.proxy(this.pdfLoadProgressHandle,this));l.addEventListener("sewiseAllPdfRenderEnd",b.proxy(this.thumbviewLoadEnd,this));this.rightCornerImg||(this.rightCornerImg=document.createElement("img"),this.rightCornerImg.className="rightCornerImg");this.haveInit||(this.haveInit=!0,b(this.playerContainer).append('<div class="sewise-mainContainer"><div class="sewise-page"><div class="sewise-canvaswrapper"><canvas class="sewise-pdfCanvas"></canvas></div><div class="sewise-textLayer"></div></div><div class="loadingIcon"></div></div>'),
this.pdfMainBox=b(this.playerContainer).find(".sewise-mainContainer"),this.pdfCanvasWrapper=this.pdfMainBox.find(".sewise-canvaswrapper"),this.loadingIcon=this.pdfMainBox.find(".loadingIcon"),this.pdfCanvas=b(this.playerContainer).find(".sewise-pdfCanvas"),this.pdfTextBox=this.pdfMainBox.find(".sewise-textLayer"),this.pdfPage=this.pdfMainBox.find(".sewise-page"));this.pdfTool=new d.PdfPlayTool(this,l.SewisePDF.pdfWorkerUrl,this.pdfCanvas.get(0));this.pdfToolDic[a.pdfurl]=this.pdfTool;if(a.pdfurl){var f=
this.getNeedDataByPdfUrl(a.pdfurl);this.pdfTool.load(a.pdfurl,f)}};d.fn.getNeedDataByPdfUrl=function(a){for(var b=this.kyuanArr.length,c=[],e=0;e<b;e++)this.kyuanArr[e].pdfurl==a&&c.push(this.kyuanArr[e]);return c};d.fn.realVideoSeekedProHandle=function(){this.param.subtitlePlugin&&this.param.subtitlePlugin.seekedProHandle();this.isSeeking=!1};d.fn.seekingProHandle=function(){this.isSeeking=!0};d.fn.seekedProHandle=function(a){if(this.pdfLoad){a=this.totalDuration*a.ptg;var b=1E3*a;if(this.questionObj.seekClickHandle(a)){var c=
this.kyuanArr,e,d,k=[],u=-1,l=[];e=c.length;for(var m=0;m<e;m++){d=c[m];var v=this.calcalateKyuanTime(d);b>=1E3*v&&(k.push({ind:m,data:d}),d.clear||(u++,l.push({ind:u,data:d})))}b=this.getSeekTime(a);c="play"!=this.playState?!1:!0;e=this.kyuanObj;0<l.length&&(this.pdfZXuePageIndex=l[l.length-1].ind,this.openZhiXue&&(this.kyuanObj=this.getZXuePageObj(),this.setShowPdfPage(),e&&e.fullname==this.kyuanObj.fullname?this.goPlay(!1,this.kyuanObj,!0,b):this.goPlay(!0,this.kyuanObj,c,b)));0<k.length&&(this.kyuanIndex=
k[k.length-1].ind,this.openZhiXue||(this.kyuanObj=this.kyuanArr[this.kyuanIndex],this.setShowPdfPage(),e&&e.fullname==this.kyuanObj.fullname?this.goPlay(!1,this.kyuanObj,!0,b):this.goPlay(!0,this.kyuanObj,c,b)));this.updateProgress(a);this.player.fireEvent("sewise-perclick")}}};d.fn.getSeekTime=function(a){for(var b=0,c=this.kyuanArr.length-1;0<=c;c--){var e=this.calcalateKyuanTime(this.kyuanArr[c]);if(a>=e){b=this.kyuanArr[c].pdf_json.sTime+(a-e);break}}return b};d.fn.getKYuanObjByVirtualTime=function(a){for(var b=
this.kyuanArr.length-1;0<=b;b--){var c=this.calcalateKyuanTime(this.kyuanArr[b]);if(a>=c)return this.kyuanArr[b]}return null};d.fn.startHandle=function(a){this.playState="play";this.player.playController.skinController.started()};d.fn.pauseHandle=function(a){this.playState="pause";this.player.playController.skinController.paused()};d.fn.endedHandle=function(a){console.log("\u64ad\u653e\u7ed3\u675f")};d.fn.waitingHandle=function(a){var b=this;this.isWaiting=!0;!this.isSeeking&&this.haveThumb&&this.hasCanPlay&&
(clearTimeout(this.waitTimeOutID),this.waitTimeOutID=setTimeout(function(){b.isWaiting&&b.showNetTip()},2E3))};d.fn.canplayHandle=function(a){this.isWaiting=!1;this.hasCanPlay=!0};d.fn.showNetTip=function(){var a=this;this.nettip.show();var b=this.nettip.find(".controlbar-nettip-sure");b.unbind("click");b.bind("click",function(){a.nettip.hide()})};d.fn.pauseBtnClickHandle=function(){"#"==this.player.playController.playVars.url||this.player.playController.isLockScreen||(this.currentShowVideo.pause(),
this.player.fireEvent("sewise-pause-send"))};d.fn.playBtnClickHandle=function(){"#"==this.player.playController.playVars.url||this.player.playController.isLockScreen||this.openZhiXue&&this.checkAllYuanClear()||(this.playEnd?(this.playEnd=!1,this.openZhiXue?this.zxuePlayFromBegin()||(this.kyuanIndex=0,this.kyuanObj=this.kyuanArr[this.kyuanIndex],this.goPlay(!0,this.kyuanObj,!0),this.setShowPdfPage()):(this.kyuanIndex=0,this.kyuanObj=this.kyuanArr[this.kyuanIndex],this.goPlay(!0,this.kyuanObj,!0),this.setShowPdfPage())):
this.currentShowVideo.play())};d.fn.zxuePlayFromBegin=function(){for(var a=!1,b=this.kyuanArr.length;0<b;){a=this.kyuanArr[0];if(a.clear){for(a=this.getJsonObjGreaterThanSTime(a.start_time);a&&a.clear;)a=this.getJsonObjGreaterThanSTime(a.start_time);a?this.jumpplayByKyuan(a):(a=this.kyuanArr[this.kyuanArr.length-1],b=a.pdf_json.sTime+a.pdf_json.duration,this.jumpplayByKyuan(a,b),this.playEnd=!0,this.isChangeVideo=!1,this.updateTimeText(b));a=!0}else a=!1;break}return a};d.fn.jumpplayByElgid=function(a,
b){this.questionObj.isAnswering||(a=this.getJsonObjByIndex(a),!b&&0<this.questionObj.allQuestionArr.length&&this.openQuestion&&this.showQuestion&&this.calcalateKyuanTime(a)>=this.questionObj.currentTopicShowTime?this.isFullScreen?alert("\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01"):this.questionObj.alertMessage("<p>\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01</p>","\u63d0\u793a",400,
310):this.jumpplayByKyuan(a))};d.fn.jumpplayByKyuan=function(a,b){var c=this.kyuanObj;this.kyuanIndex=this.getPdfObjInArrIndex(a.elgid2);this.calculateZXueIndex(this.kyuanIndex);this.kyuanObj=this.kyuanArr[this.kyuanIndex];a=b?b:this.kyuanObj.pdf_json.sTime;this.updateProgress(this.calcalateKyuanTime(this.kyuanObj));b="play"===this.playState?!0:!1;c&&c.fullname==this.kyuanObj.fullname?this.goPlay(!1,this.kyuanObj,b,a):this.goPlay(!0,this.kyuanObj,b,a);this.setShowPdfPage()};d.fn.timeUpdateHandle=
function(a){if(!this.playEnd){var b=this.currentShowVideo.currentTime;this.param.subtitlePlugin&&this.param.subtitlePlugin.updateSubtitleCurson(b);if(0!=b||"noreturn"==a)this.maxPlayTime<this.virtualPlayTime&&(this.maxPlayTime=this.virtualPlayTime),this.checkIsShowQuestionBox(),this.questionObj.isAnswering||(this.checkZXueSeekPlay(this.virtualPlayTime),this.checkChangePdf(),this.playEnd||this.updateTimeText(b),this.isChangeVideo=!1)}};d.fn.checkChangePdf=function(){if(this.pdfLoad&&this.kyuanArr){var a=
1E3*this.currentShowVideo.currentTime;if(this.kyuanObj&&a+100>=1E3*(this.kyuanObj.pdf_json.sTime+this.kyuanObj.pdf_json.duration)){this.currentShowVideo.pause();this.kyuanObj.isShow=!1;var b=this.kyuanObj;this.kyuanIndex+1===this.kyuanArr.length?this.playEndContro():(this.kyuanIndex++,this.calculateZXueIndex(this.kyuanIndex),this.kyuanObj=this.kyuanArr[this.kyuanIndex],this.kyuanObj.fullname==b.fullname?1E3>Math.abs(1E3*this.kyuanObj.pdf_json.sTime-a)?this.goPlay(!1,this.kyuanObj,!0,-1):this.goPlay(!1,
this.kyuanObj,!0):this.goPlay(!0,this.kyuanObj,!0),this.setShowPdfPage())}}};d.fn.goPlay=function(a,f,c,e){var d=e?e:f.pdf_json.sTime;a?(this.isChangeVideo=!0,this.currentShowVideo&&(b(this.currentShowVideo).hide(),this.currentShowVideo.volume=0,this.preLoadVideoTool.resetVideoByUrl(this.currentShowVideo.src)),(a=this.preLoadVideoTool.getVideoByUrl(f.fullname))||(a=this.player.getVideo()),this.registerVideoEvent(a),a.autoplay=c,b(a).show(),a.volume=this.player.playController.playVars.volume,parseFloat(b(a).attr("sTime"))!=
d&&(a.currentTime=d),c&&a.play()):(this.currentShowVideo.autoplay=c,-1!=e?(this.isChangeVideo=!0,c=this.currentShowVideo.duration-d,this.currentShowVideo.currentTime=d,1<c&&this.currentShowVideo.play()):this.currentShowVideo.paused&&this.currentShowVideo.play());this.playEnd=!1};d.fn.registerVideoEvent=function(a){this.currentShowVideo&&(b(this.currentShowVideo).unbind("timeupdate"),b(this.currentShowVideo).unbind("play"),b(this.currentShowVideo).unbind("pause"),b(this.currentShowVideo).unbind("seeked"),
b(this.currentShowVideo).unbind("seeking"),b(this.currentShowVideo).unbind("error"),b(this.currentShowVideo).unbind("ended"),b(this.currentShowVideo).unbind("canplay"),b(this.currentShowVideo).unbind("waiting"));this.currentShowVideo=a;b(this.currentShowVideo).bind("timeupdate",b.proxy(this.timeUpdateHandle,this));b(this.currentShowVideo).bind("play",b.proxy(this.startHandle,this));b(this.currentShowVideo).bind("pause",b.proxy(this.pauseHandle,this));b(this.currentShowVideo).bind("seeked",b.proxy(this.realVideoSeekedProHandle,
this));b(this.currentShowVideo).bind("seeking",b.proxy(this.seekingProHandle,this));b(this.currentShowVideo).bind("error",b.proxy(this.errorHandle,this));b(this.currentShowVideo).bind("ended",b.proxy(this.endedHandle,this));b(this.currentShowVideo).bind("waiting",b.proxy(this.waitingHandle,this));b(this.currentShowVideo).bind("canplay",b.proxy(this.canplayHandle,this))};d.fn.checkIsShowQuestionBox=function(){this.kyuanObj&&this.kyuanObj.topic_json&&0!=this.kyuanObj.topic_json.length&&this.questionObj.checkShowQuestionBox(this.virtualPlayTime)};
d.fn.checkZXueSeekPlay=function(a){if(0!=this.kyuanArr.length&&this.openZhiXue){a*=1E3;for(var b=this.kyuanArr.length,c=0;c<b;c++){var e=this.kyuanArr[c];if(e.clear){var d=this.calcalateKyuanTime(e),k=Math.abs(a-1E3*d);if(a>=1E3*d&&1E3>k){for(e=this.getJsonObjGreaterThanSTime(e.start_time);e&&e.clear;)e=this.getJsonObjGreaterThanSTime(e.start_time);e?(this.jumpplayByKyuan(e),this.virtualPlayTime=this.calcalateKyuanTime(e)):(e=this.kyuanArr[this.kyuanArr.length-1],d=e.pdf_json.sTime+e.pdf_json.duration,
this.jumpplayByKyuan(e,d),this.playEnd=!0,this.isChangeVideo=!1,this.updateTimeText(d))}}}}};d.fn.setShowPdfPage=function(a){var f=this;this.isRenderPage=!0;this.param.subtitlePlugin&&this.kyuanObj.vtt_json&&0<this.kyuanObj.vtt_json.length&&(a=this.param.subtitlePlugin.produceVttFile(this.kyuanObj.vtt_json),this.param.subtitlePlugin.clear(),b(this.param.subtitlePlugin.subContainer).empty(),this.param.subtitlePlugin.loadStringWebVtt(a));this.kyuanObj.isShow=!0;a=this.pdfToolDic[this.kyuanObj.pdfurl];
var c=60;this.kyuanObj.pdf_json.vpercent&&(c=parseInt(this.kyuanObj.pdf_json.vpercent));c=b(this.playerContainer).width()*(100-c)/100;a.gotoPage(this.kyuanObj.pdf_json.page,!0,c,function(){f.adjustVideoPositon(parseInt(f.kyuanObj.pdf_json.vpercent))});this.player.fireEvent("sewise-pdf-change",this.kyuanObj);this.updatePageText();if(a=this.findScaleImgObjByElgid(this.kyuanObj.elgid2))this.rightCornerImg.src=a.img.src,b(this.rightCornerImg).show()};d.fn.updateTimeText=function(a){for(var b=0,c=0;c<
this.kyuanArr.length;c++){var e=this.kyuanArr[c];c===this.kyuanIndex?a>=e.pdf_json.sTime&&(b+=a-e.pdf_json.sTime):this.kyuanIndex>c&&(b+=e.duration)}b>this.totalDuration&&(b=this.totalDuration);this.isChangeVideo||(this.virtualPlayTime=b,this.updateProgress(b))};d.fn.updateProgress=function(a){b(this.playerContainer).find(".controlbar-playtime").text(l.Sewise.SkinUtils.stringer.secondsToHMS(a)+"/"+l.Sewise.SkinUtils.stringer.secondsToHMS(this.totalDuration));a=a/this.totalDuration*100;a=100<a?100:
a;var f=b(this.playerContainer).find(".controlbar-progress-playedline");f.css("width",a+"%");f=f.width()-8;b(this.playerContainer).find(".controlbar-progress-playpoint").css("left",f);this.nettip.css("left",a/100*this.playerWidth-134+"px")};d.fn.updatePageText=function(){var a;b(this.playerContainer).find(".controlbar-other-pageTool").show();a=this.openZhiXue?this.pdfZXuePageIndex+1+"/"+(this.totalPage-this.hidePageNum):this.kyuanIndex+1+"/"+this.totalPage;b(this.playerContainer).find(".controlbar-other-page").text(a)};
d.fn.clear=function(){};d.fn.updatePlayer=function(a){};d.fn.fullSceenHandle=function(){function a(){f.playerHeight=b(f.playerContainer).height();if("complex"===f.playMode){b(f.videoContainer).css("height",f.playerHeight-106+"px");f.pdfMainBox.css("height",f.playerHeight-106+"px");var a=f.pdfToolDic[f.kyuanObj.pdfurl];a.refreshPageView();a.draw();f.bigPlayBtn.css("margin-top",-(f.bigPlayBtn.height()/2+53)+"px")}else b(f.videoContainer).css("height",f.playerHeight-77+"px"),f.bigPlayBtn.css("margin-top",
-(f.bigPlayBtn.height()/2+38)+"px");f.param.subtitlePlugin.fullSceenHandle(f.currentShowVideo.currentTime)}var f=this;this.isFullScreen=!0;var c=this.player.playController.skinController.getElementObject();this.oldControlbarBottom=c.$controlbar.css("bottom");c.$controlbar.css("bottom","0px");this.player.playController.canHideSkin=!1;this.oldVideoH=b(this.videoContainer).height();b(this.videoContainer).css("height","100%");this.rightCornerImg&&b(this.rightCornerImg).remove();"complex"===this.playMode&&
(this.adjustVideoPositon(parseInt(this.kyuanObj.pdf_json.vpercent)),this.resetThumbViewPos(),this.resetGreyRectPos());this.changeElementPos();this.playerWidth=b(this.playerContainer).width();this.playerHeight=b(this.playerContainer).height();this.scaleBoxHide?b(this.param.subtitlePlugin.subContainer).css("bottom","77px"):b(this.param.subtitlePlugin.subContainer).css("bottom","106px");this.videoOnRT=this.pdfOnRT=!1;a();setTimeout(function(){a()},240)};d.fn.cancelFullScreenHandle=function(){var a=this;
this.isFullScreen=!1;this.player.playController.skinController.getElementObject();this.player.playController.canHideSkin=!1;this.playerWidth=b(this.playerContainer).width();this.playerHeight=b(this.playerContainer).height();this.rightCornerImg&&b(this.rightCornerImg).remove();b(this.videoContainer).css("height","100%");this.bigPlayBtn.css("margin-top",-(this.bigPlayBtn.height()/2)+"px");"complex"===this.playMode&&(this.adjustVideoPositon(parseInt(this.kyuanObj.pdf_json.vpercent)),this.resetThumbViewPos(),
this.resetGreyRectPos(),setTimeout(function(){var b=a.pdfToolDic[a.kyuanObj.pdfurl];b.refreshPageView();b.draw()},120));this.changeElementPos();b(this.param.subtitlePlugin.subContainer).css("bottom","0px");this.param.subtitlePlugin.cancelFullScreenHandle(this.currentShowVideo.currentTime);this.scaleBoxHide?this.elementObj.$controlbar.css("bottom","-77px"):this.elementObj.$controlbar.css("bottom","-106px")};d.fn.controlbarStateHandle=function(a){a.isShow?this.isFullScreen&&(this.scaleBoxHide?b(this.param.subtitlePlugin.subContainer).css("bottom",
"77px"):b(this.param.subtitlePlugin.subContainer).css("bottom","106px")):b(this.param.subtitlePlugin.subContainer).css("bottom","0px")};d.fn.errorHandle=function(a){function d(){b(e.currentShowVideo).unbind("canplay",d);if(h)b(e.currentShowVideo).bind("seeked",c),e.currentShowVideo.pause(),e.currentShowVideo.currentTime=k-1;else{var a=e.kyuanArr[e.kyuanIndex+1];e.openZhiXue?(a=e.calcalateKyuanTime(a),e.checkZXueSeekPlay(a)):e.jumpplayByKyuan(a);b(e.currentShowVideo).bind("timeupdate",b.proxy(e.timeUpdateHandle,
e))}}function c(){b(e.currentShowVideo).unbind("seeked",c);e.playEndContro();b(e.currentShowVideo).bind("timeupdate",b.proxy(e.timeUpdateHandle,e))}console.log("vplay e");var e=this,h=!1;if(a.target.error&&3==a.target.error.code){h=this.kyuanIndex+1==this.kyuanArr.length?!0:!1;this.currentShowVideo.style.visibility="visible";this.player.playController.skinController.getControlBar().hideBuffer();var k=this.currentShowVideo.currentTime;b(this.currentShowVideo).unbind("timeupdate");b(this.currentShowVideo).unbind("canplay");
b(this.currentShowVideo).bind("canplay",d);this.currentShowVideo.load()}};d.fn.durationHandle=function(){var a=this.calcalateVideoDuration();this.totalDuration=a;this.player.setDuration(a);if(this.questionObj&&0<this.questionObj.allQuestionArr.length&&(this.questionObj.initTopicLines(),a=this.questionObj.allQuestionArr.length,this.param.seekTime)){var b=this.getJsonObjByIndex(this.questionObj.allQuestionArr[a-1].kyuan_uuid),c=this.calcalateKyuanTime(b),c=c+(this.questionObj.allQuestionArr[a-1].showTime-
b.pdf_json.sTime);this.questionObj.currentTopicShowTime=this.param.seekTime>=c?this.totalDuration:this.param.seekTime}};d.fn.pdfLoadHandle=function(){this.pdfLoad||(this.pdfLoad=!0,this.loadingIcon.hide(),this.setShowPdfPage(),this.questionObj&&this.questionObj.isAnswering||this.param.autostart&&(this.param.seekTime&&parseInt(this.param.seekTime)==parseInt(this.totalDuration)?this.playEndContro():this.currentShowVideo.play()),this.initBtn||(this.initButtons(),this.doVideoDrag()),this.param.subtitlePlugin&&
b(this.param.subtitlePlugin.subContainer).css("pointer-events","none"),this.arrow=b(this.playerContainer).find(".vodSimpleVPass .drag-arrow"),this.arrow.show(),this.arrow.css("left",b(this.videoContainer).width()-this.arrow.width()/2+"px"),this.player.fireEvent("sewise-pdf-loadend"))};d.fn.playEndContro=function(){this.currentShowVideo.paused||this.currentShowVideo.pause();this.playEnd=!0;this.playState="pause";this.player.playController.skinController.paused();this.virtualPlayTime=this.totalDuration;
this.updateProgress(this.totalDuration);this.maxPlayTime=this.virtualPlayTime};d.fn.doCheckPdfShow=function(a){for(var b=this.kyuanArr.length-1;0<=b;b--){var c=this.calcalateKyuanTime(this.kyuanArr[b]);if(a>=c){this.kyuanIndex=b;this.calculateZXueIndex(this.kyuanIndex);this.kyuanObj=this.kyuanArr[this.kyuanIndex];this.setShowPdfPage();break}}};d.fn.initButtons=function(){var a=this,d,c;this.initBtn=!0;b(this.playerContainer).find(".controlbar-other-pre").click(function(b){m(b);a.player.playController.isLockScreen||
a.questionObj&&a.questionObj.isAnswering||(a.openZhiXue?0<a.pdfZXuePageIndex&&(d=a.pdfZXuePageIndex-1,a.pdfZXuePageIndex=d,c=a.getZXuePageObj(),a.jumpplayByKyuan(c)):0<a.kyuanIndex&&(d=a.kyuanIndex-1,a.kyuanIndex=d,c=a.kyuanArr[d],a.jumpplayByKyuan(c)))});b(this.playerContainer).find(".controlbar-other-next").click(function(b){m(b);a.player.playController.isLockScreen||a.questionObj&&a.questionObj.isAnswering||(a.openZhiXue?a.pdfZXuePageIndex<a.kyuanArr.length-1-a.hidePageNum&&(d=a.pdfZXuePageIndex+
1,c=a.getZXuePageObj(d),0<a.questionObj.allQuestionArr.length&&a.openQuestion&&a.showQuestion&&a.calcalateKyuanTime(c)>=a.questionObj.currentTopicShowTime?a.isFullScreen?alert("\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01"):a.questionObj.alertMessage("<p>\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01</p>","\u63d0\u793a",400,310):(a.pdfZXuePageIndex=d,a.jumpplayByKyuan(c))):a.kyuanIndex<
a.kyuanArr.length-1&&(d=a.kyuanIndex+1,c=a.kyuanArr[d],0<a.questionObj.allQuestionArr.length&&a.openQuestion&&a.showQuestion&&a.calcalateKyuanTime(c)>=a.questionObj.currentTopicShowTime?a.isFullScreen?alert("\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01"):a.questionObj.alertMessage("<p>\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01</p>","\u63d0\u793a",400,310):(a.kyuanIndex=d,a.jumpplayByKyuan(c))))});
b(this.playerContainer).find(".controlbar-btns-subtitle").click(function(c){m(c);a.param.subtitlePlugin&&(a.param.subtitlePlugin.toggle(),a.param.subtitlePlugin.subtitleIsShow?b(a.playerContainer).find(".controlbar-btns-subtitle").removeClass("controlbar-btns-subtitle-grey"):b(a.playerContainer).find(".controlbar-btns-subtitle").addClass("controlbar-btns-subtitle-grey"))});b(this.playerContainer).find(".controlbar-btns-zxue").click(function(c){a.player.playController.isLockScreen||(a.openZhiXue?(a.closeZXueMode(!0),
b(a.playerContainer).find(".controlbar-btns-zxue").removeClass("selected")):(a.openZXueMode(!0),b(a.playerContainer).find(".controlbar-btns-zxue").addClass("selected")))});b(this.playerContainer).find(".controlbar-btns-qanswer").addClass("selected");b(this.playerContainer).find(".controlbar-btns-qanswer").click(function(c){a.showQuestion?(a.showQuestion=!1,b(a.playerContainer).find(".controlbar-btns-qanswer").removeClass("selected"),a.questionObj.isAnswering&&(a.questionObj.clear(),a.questionObj.isAnswering=
!1)):(a.showQuestion=!0,b(a.playerContainer).find(".controlbar-btns-qanswer").addClass("selected"))});b(this.playerContainer).mouseenter(function(b){m(b);a.arrow.show()});b(this.playerContainer).mouseleave(function(b){m(b);a.arrow.hide()})};d.fn.hideZXueBtn=function(a){(this.hideZXueBtnState=a)?b(this.playerContainer).find(".controlbar-btns-zxue").hide():b(this.playerContainer).find(".controlbar-btns-zxue").show()};d.fn.hideQAnswerBtn=function(a){a?b(this.playerContainer).find(".controlbar-btns-qanswer").hide():
b(this.playerContainer).find(".controlbar-btns-qanswer").css("display","block")};d.fn.closeZXueMode=function(a){this.openZhiXue=!1;for(var d=this.kyuanArr.length,c=0;c<d;c++){var e=this.kyuanArr[c];e.clear&&(e=this.findScaleImgIndex(e.elgid2),0<=e&&b(this.scaleImgItemList[e].img).show())}this.progressBox.find(".greyTimeRect").hide();this.updatePageText();a&&this.player.fireEvent("sewise-zxue-open",!1)};d.fn.openZXueMode=function(a){this.openZhiXue=!0;for(var d=this.kyuanArr.length,c=0;c<d;c++){var e=
this.kyuanArr[c];e.clear&&(e=this.findScaleImgIndex(e.elgid2),0<=e&&b(this.scaleImgItemList[e].img).hide())}this.progressBox.find(".greyTimeRect").show();this.updatePageText();a&&this.player.fireEvent("sewise-zxue-open",!0)};d.fn.checkDefaultZXueSate=function(){this.hideZXueBtnState||(this.defaultOpenZXue?(this.openZXueMode(),b(this.playerContainer).find(".controlbar-btns-zxue").addClass("selected")):(this.closeZXueMode(),b(this.playerContainer).find(".controlbar-btns-zxue").removeClass("selected")))};
d.fn.resumeBookRecoud=function(a){for(var d=this.kyuanArr.length,c=0;c<d;c++){var e=this.kyuanArr[c];if(e.kpoint_uuid===a){e.clear=!1;var h=this.findScaleImgIndex(e.elgid2);0<=h&&(b(this.scaleImgItemList[h].img).show(),this.hidePageNum--);h=this.getPdfObjInArrIndex(e.elgid2);this.pdfZXuePageIndex>=h?this.pdfZXuePageIndex++:this.doCheckPdfShow(this.virtualPlayTime);this.updatePageText();b(this.greyRectDic[e.elgid2]).remove();delete this.greyRectDic[e.elgid2];this.greyRectDic[e.elgid2]=null}}};d.fn.getZXuePageObj=
function(a){a||(a=this.pdfZXuePageIndex);for(var b=this.kyuanArr.length,c=-1,e=0;e<b;e++)if(!this.kyuanArr[e].clear&&(c++,c===a))return this.kyuanArr[e];return null};d.fn.calculateZXueIndex=function(a){for(var b=this.kyuanArr.length,c=-1,e=0;e<b;e++)if(this.kyuanArr[e].clear||c++,e==a){this.pdfZXuePageIndex=c;break}};d.fn.resetThumbViewPos=function(){for(var a=this.scaleImgItemList.length,d,c=this.totalDuration,e=b(this.playerContainer).width(),h=0;h<a;h++){d=this.scaleImgItemList[h];var k=this.calcalateKyuanTime({elgid:d.elgid,
start_time:d.sTime}),k=e/(1E3*c)*k*1E3;b(d.img).css("left",k+"px");d.left=k;var l=b(d.img).data("param");l.left=k;b(d.img).data("param",l)}};d.fn.thumbviewLoadEnd=function(a){function f(a,c){for(var e=a.length,d=0;d<e;d++){var f=a[d];if(parseInt(b(f.canvas).attr("page"))===c)return f.canvas}return null}function c(a){m(a);if(!g.questionObj||!g.questionObj.isAnswering){var c=b(a.currentTarget).data("param").uuid;b(a.currentTarget).data("param");(a=g.getJsonObjByIndex(c))&&(0<g.questionObj.allQuestionArr.length&&
g.openQuestion&&g.showQuestion&&g.calcalateKyuanTime(a)>=g.questionObj.currentTopicShowTime?g.isFullScreen?alert("\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01"):g.questionObj.alertMessage("<p>\u4e0d\u8981\u5077\u61d2\uff0c\u7b54\u5b8c\u95ee\u9898\u540e\u624d\u5141\u8bb8\u5feb\u8fdb\u54e6\uff01</p>","\u63d0\u793a",400,310):g.jumpplayByKyuan(a))}}function e(a){var c=b(a.currentTarget);c.css("width");b(g.playerContainer).width();var e=b(a.currentTarget).data("param"),
d=4*e.normalW,f=4*e.normalH,h=e.left-(d/2-e.normalW/2);0>h&&(h=0);h+d>g.playerWidth&&(h=g.playerWidth-d-1);c.css("z-index",1);c.data("isScale",!0);c.animate({width:d+"px",height:f+"px",bottom:"0px",left:h+"px"},g.effectDuration,"linear",function(a){a=e.title?e.title:"\u77e5\u8bc6\u70b9";12<a.length&&(a=a.substr(0,12)+"...");g.knowledgeTitleEle.show();g.knowledgeTitleEle.css("width",d+"px");g.knowledgeTitleEle.find("span").text(a);g.knowledgeTitleEle.css("left",h+"px")});a=g.findScaleImgIndex(b(a.currentTarget).data("param").uuid);
c=a-1;a+=1;g.scaleImgItemList[c]&&(c=g.scaleImgItemList[c].img,f=b(c).data("param").left+e.normalW,h<f&&(f=h-e.normalW-3,b(c).css("z-index",1),b(c).animate({bottom:"0px",left:f+"px"},g.effectDuration,"linear",function(a){})));g.scaleImgItemList[a]&&(c=g.scaleImgItemList[a].img,f=b(c).data("param").left,h+d>f&&(f=h+d+3,b(c).css("z-index",1),b(c).animate({bottom:"0px",left:f+"px"},g.effectDuration,"linear",function(a){})))}function h(a){g.knowledgeTitleEle.hide();b(g.playerContainer).find(".controlbar-scaleIcon img").each(function(){var a=
b(this).data("param"),c=a.left,e=b(this).width(),d=b(this).css("left"),f=b(this);b(this).stop(!0);e>a.normalW?b(this).animate({width:a.normalW+"px",height:a.normalH+"px",left:c+"px",bottom:"2px"},g.effectDuration,"linear",function(a){f.data("isScale",!1)}):parseInt(d)!=parseInt(c)&&b(this).animate({left:c+"px",bottom:"2px"},g.effectDuration,"linear",function(a){});b(this).css("z-index",0)})}function k(a){a.preventDefault();if(g.openZhiXue&&!g.questionObj.isAnswering){var c;c=b(a.target).data("param");
c=g.getJsonObjByIndex(c.uuid);if(!g.param.studyProgress||100!=g.param.studyProgress)if(c=g.getAllKyuanArrByKpointID(c.kpoint_uuid),c=c[c.length-1],c.start_time+c.duration>g.maxPlayTime)return;g.dragScaleImg?(c=g.dragScaleImg,c.parentElement||b(g.playerContainer).append(c)):(c=document.createElement("img"),c.style.position="absolute",b(g.playerContainer).append(c),g.dragScaleImg=c);v=a.target;c.src=a.target.src;c.style.width=b(a.target).width()+"px";c.style.height=b(a.target).height()+"px";c.style.top=
b(a.target).offset().top+"px";c.style.left=b(a.target).offset().left+"px";c.style.zIndex=0;c.style.opacity=0;y=b(a.target).offset().top;b(c).show();b(g.playerContainer).bind("mousemove",u);b(document).bind("mouseup",x)}}function u(a){document.selection&&document.selection.empty();window.getSelection&&window.getSelection().removeAllRanges();var c=g.dragScaleImg;c.style.opacity=1;b(c).css("left",a.pageX-b(c).width()/2-a.currentTarget.getBoundingClientRect().left);b(c).css("top",a.pageY-b(c).height()/
2-a.currentTarget.getBoundingClientRect().top-b(document).scrollTop())}function x(a){b(g.playerContainer).unbind("mousemove",u);b(document).unbind("mouseup",x);a=b(g.dragScaleImg).offset().top;if(80<y-a&&0!=a){a=b(v).data("param");a=g.getJsonObjByIndex(a.uuid);for(var c=g.getAllKyuanArrByKpointID(a.kpoint_uuid),e=0;e<c.length;e++){a=c[e];a.clear=!0;g.drawGreyRect(a,!0);var d=g.findScaleImgIndex(a.elgid2);0<=d&&(b(g.scaleImgItemList[d].img).hide(),g.hidePageNum++,g.calculateZXueIndex(g.kyuanIndex),
g.updatePageText());g.immediatelyZXueGoToPlay(a)}g.player.fireEvent("sewise-cut-bookpage",a)}g.dragScaleImg&&b(g.dragScaleImg).hide()}this.player.duration();var y,v,g=this,r=this.pdfUrlArr.length;this.loadPdfNum++;if(this.loadPdfNum<=r){this.mainContainerW=this.pdfMainBox.find("canvas").width();this.mainContainerH=this.pdfMainBox.find("canvas").height();var t=a.detail.data;0<t.length&&(this.mainContainerW=t[0].canvas.width,this.mainContainerH=t[0].canvas.height);for(var r=this.kyuanArr.length,z=parseInt(23*
this.mainContainerW/this.mainContainerH),B=b(this.playerContainer).width(),w=0;w<r;w++){var n=this.kyuanArr[w],q;if(n&&n.pdfurl===a.detail.url){var p=document.createElement("img");q=f(t,n.pdf_json.page);p.src=q.toDataURL("image/png");p.width=z;p.height=23;this.pdfToolDic[a.detail.url].pageNum===n.pdf_json.page&&(this.rightCornerImg.src=q.toDataURL("image/png"));q=this.calcalateKyuanTime(n);this.totalDuration=this.calcalateVideoDuration();q=B/(1E3*this.totalDuration)*q*1E3;b(this.playerContainer).find(".controlbar-scaleIcon").append(p);
b(p).css("left",q+"px");var A=n.elgid2;b(p).data("param",{left:q,page:n.pdf_json.page,uuid:A,sTime:n.start_time,title:n.title,pdfUrl:n.pdfurl,normalW:z,normalH:23});this.scaleImgItemList.push({left:q,img:p,page:n.pdf_json.page,uuid:A,elgid:n.elgid,klgid:n.kpoint_uuid,sTime:n.start_time,pdfUrl:n.pdfurl});b(p).mouseenter(e);b(p).mouseleave(h);b(p).click(c);b(p).bind("mousedown",k);n.clear&&(this.drawGreyRect(n,!1),this.hidePageNum++)}}this.loadPdfNum==this.pdfUrlArr.length?(this.haveThumb=!0,this.scaleImgItemList.sort(function(a,
b){return a.left-b.left}),this.checkDefaultZXueSate(),this.player.fireEvent("sewise-scaleimgs-loadend"),this.pdfLoadHandle()):(a=this.pdfUrlArr[this.loadPdfNum],r=new d.PdfPlayTool(this,l.SewisePDF.pdfWorkerUrl,this.pdfCanvas.get(0)),this.pdfToolDic[a]=r,t=this.getNeedDataByPdfUrl(a),r.load(a,t))}};d.fn.pdfLoadProgressHandle=function(a){};d.fn.getScaleImgList=function(){return this.scaleImgItemList};d.fn.immediatelyZXueGoToPlay=function(a){var b=this.virtualPlayTime,c,e=this.getJsonObjGreaterThanSTime(a.start_time);
c=e?this.calcalateKyuanTime(e):this.totalDuration;a=this.calcalateKyuanTime(a);e?b>=a&&b<=c&&this.jumpplayByKyuan(e):b>=a&&b<=c&&(b=this.kyuanArr[this.kyuanArr.length-1],c=b.pdf_json.sTime+b.pdf_json.duration,this.jumpplayByKyuan(b,c),this.playEndContro(),this.isChangeVideo=!1,this.updateTimeText(c))};d.fn.drawGreyRect=function(a,d){var c=this.getJsonObjGreaterThanSTime(a.start_time),e=c?this.calcalateKyuanTime(c):this.totalDuration,f=this.progressBox.width(),k=1E3*this.totalDuration,l=this.calcalateKyuanTime(a),
c=f/k*l*1E3,e=f/k*(e-l)*1E3,f=document.createElement("div");f.className="greyTimeRect";f.style.left=c+"px";f.style.width=e+"px";f.name=a.elgid;this.greyRectDic[a.elgid2]=f;this.progressBox.append(f);d||b(f).hide()};d.fn.resetGreyRectPos=function(){for(var a in this.greyRectDic){var b=this.getJsonObjByIndex(a),c=this.getJsonObjGreaterThanSTime(b.start_time),c=c?this.calcalateKyuanTime(c):this.totalDuration,e=this.progressBox.width(),d=1E3*this.totalDuration,k=this.calcalateKyuanTime(b),b=e/d*k*1E3,
c=e/d*(c-k)*1E3;this.greyRectDic[a]&&(this.greyRectDic[a].style.left=b+"px",this.greyRectDic[a].style.width=c+"px")}};d.fn.findScaleImgIndex=function(a){for(var b=this.scaleImgItemList.length,c=0;c<b;c++)if(this.scaleImgItemList[c].uuid===a)return c;return-1};d.fn.findScaleImgObjByElgid=function(a){for(var b=this.scaleImgItemList.length,c=0;c<b;c++){var d=this.scaleImgItemList[c];if(d.uuid===a)return d}return null};d.fn.getJsonObjGreaterThanSTime=function(a){for(var b=this.kyuanArr,c=b.length,d=0;d<
c;d++){var h=b[d];if(h.start_time>a)return h}return null};d.fn.getPdfObjInArrIndex=function(a){for(var b=this.kyuanArr,c=b.length,d=0;d<c;d++)if(b[d].elgid2===a)return d;return null};d.fn.getJsonObjByIndex=function(a){for(var b=this.kyuanArr,c=b.length,d=0;d<c;d++){var h=b[d];if(h.elgid2===a)return h}return null};d.fn.produceVttFile=function(a){for(var b=a.length,c="WEBVTT FILE\n\n",d=1,h,k,m=0;m<b;m++)h=a[m],h.eTime&&h.content&&(k=d+"\n"+l.Sewise.SkinUtils.stringer.secondsToHMS(h.sTime)+".000 --\x3e "+
l.Sewise.SkinUtils.stringer.secondsToHMS(h.eTime)+".000\n",k=h.hasOwnProperty("show")&&!1===h.show?k+"<c.sewiseHideVtt>"+h.content+"</c>\n\n":k+h.content+"\n\n",c+=k,d++);return c}})(window,window.jQuery);